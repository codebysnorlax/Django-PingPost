{% extends "layout.html" %}
{% comment %} ------------------------------------------- {% endcomment %}
{% block title %}
Ping-Post | Creative
{% endblock %}
{% comment %} ------------------------------------------- {% endcomment %}
{% block content %}
<div class="auth-wrapper d-flex justify-content-center">
    <div class="auth-card" style="max-width: 500px;">
        <h4 style="margin: 0;">
            {% if form.instance.pk %}Edit Ping{% else %}Create Ping{% endif %}
        </h4>
        <p class="pp-muted mt-1 mb-3 small">Share what's on your mind</p>

        <form method='post' enctype='multipart/form-data' class='vstack gap-2'>
            {% csrf_token %}

            <div class="mb-2">
                {{ form.text.label_tag }}
                {{ form.text }}
            </div>

            <div class="mb-2">
                <label class="pp-muted small">Photo (Optional)</label>
                <div class="drop-zone" onclick="document.getElementById('{{ form.photo.id_for_label }}').click()">
                    <i class="bi bi-cloud-upload"></i>
                    <p class="pp-muted small">Drag & drop or click to upload</p>
                </div>
                <input type="file" id="{{ form.photo.id_for_label }}" name="{{ form.photo.name }}" accept="image/*" style="display: none;">
                <div id="preview"></div>
            </div>

            <div class="form-actions mt-2">
                <button class='btn btn-accent rounded-pill px-3' type='submit'>
                    {% if form.instance.pk %}Update{% else %}Post{% endif %}
                </button>
                <a class='btn btn-outline-accent rounded-pill px-3' href="{% url 'tweet_list' %}">Back</a>
            </div>
        </form>
    </div>
</div>

<script>
const dropZone = document.querySelector('.drop-zone');
const fileInput = document.getElementById('{{ form.photo.id_for_label }}');
const preview = document.getElementById('preview');

dropZone.addEventListener('dragover', e => { e.preventDefault(); dropZone.style.background = 'rgba(125, 43, 88, 0.15)'; });
dropZone.addEventListener('dragleave', () => dropZone.style.background = 'rgba(125, 43, 88, 0.05)');
dropZone.addEventListener('drop', e => {
    e.preventDefault();
    dropZone.style.background = 'rgba(125, 43, 88, 0.05)';
    if (e.dataTransfer.files.length) {
        fileInput.files = e.dataTransfer.files;
        showPreview(e.dataTransfer.files[0]);
    }
});

fileInput.addEventListener('change', e => e.target.files.length && showPreview(e.target.files[0]));

function showPreview(file) {
    if (file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = e => preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
        reader.readAsDataURL(file);
    }
}
</script>
{% endblock %}
